#!/usr/bin/env bash

set -e
[ -n "$RBENV_DEBUG" ] && set -x

if [ "$1" = "--version" ] || [ "$1" = "-v" ]; then
  echo "rbenv-jit 0.6.0"
  exit
fi

version=$(echo $RBENV_VERSION | tr -d '.' | cut -c 1-2)

if [[ $version -gt "25" ]]; then
  if [[ $(uname) == "Darwin" && $(uname -m) == "arm64" && $version -gt "31" ]]; then
    echo "export RUBYOPT='--yjit $RUBYOPT'"
  else
    echo "export RUBYOPT='--jit $RUBYOPT'"
  fi
fi

if [[ $version -eq "ruby-dev" ]]; then
  echo "export RUBYOPT='--yjit $RUBYOPT'"
fi
